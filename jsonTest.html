<html>
<head>
   <link type="text/css" rel="stylesheet" href="jsonTest.css">

   <script src="build/sigma.min.js"></script>
<!--<script src="build/plugins/sigma.parsers.json.min.js"></script>-->
  
   <script type="text/javascript" src="heap.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
   
</head>
<body>
    <input type="textbox" id='jsonText' value='{"gateways": [{"id": "main","type": "main", "nodes": ["html", "activemq"]}, {"id":"activemq", "type": "activemq", "nodes": ["main", "html"]}, {"id": "service", "type": "service", "nodes":[]}, {"id": "html", "type": "html", "nodes": ["activemq"]}]} '></input>
   <input type="button" value="submit" id="submit" onclick="uponClick()"></input>
   <script>
      function uponClick() {
      var hi = JSON.parse(document.getElementById("jsonText").value);
      drawgraph(hi);
      }
  </script>

    <div id="container"></div> 


<script>
   
   function drawgraph(hi) {
 
   var weights = {activemq: 1, main:2, html:3, postmsg:4, service:5};

   
      var heap = new Heap(function cmp(a, b) {
        if (a.weight < b.weight) {
          return -1;
        } 
        if (a.weight > b.weight) {
          return 1;
        }
        return 0;
      });

   var s = new sigma('container');
 
   var main = new RegExp('/main+/');

   alert(hi);
   var x = 0;
   var y = 0;
   var edge = 0;
   for (i = 0; i < hi.gateways.length; i++) {
      var tempNode = hi.gateways[i];
      tempNode.label = tempNode.id;
      tempNode.size = 3;
      tempNode.weight = weights[String(tempNode.type)];
     
       heap.push(tempNode);
     
      }
   
    for (i = 0; i < hi.gateways.length; i++) {
      var tempNode = heap.pop();
      tempNode.x = x+0.2;
      tempNode.y = y + 0.2;
      x = x+0.2;
      y = y+0.2;
      s.graph.addNode(tempNode);

   }
   
   for (i = 0; i < hi.gateways.length; i++) {
      var tempNode = hi.gateways[i];
      if (tempNode.nodes != {}) {
         for (j = 0; j < tempNode.nodes.length; j++) {
         s.graph.addEdge({id:edge.toString(), target: tempNode.nodes[j], source: tempNode.id});
         edge++;
          }
      }
      
   }
      alert("done graphing");
 
   }
</script>
 
</body>
</html>