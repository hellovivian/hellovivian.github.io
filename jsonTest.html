<html>
<head>
   <link type="text/css" rel="stylesheet" href="jsonTest.css">

   <script src="build/sigma.min.js"></script>
<!--<script src="build/plugins/sigma.parsers.json.min.js"></script>-->
  
   <script type="text/javascript" src="heap.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
   <script type="text/javascript" src="build/plugins/sigma.parsers.gexf.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=PT+Sans|Zilla+Slab+Highlight" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Zilla+Slab" rel="stylesheet">
   
</head>
<body>
   <div id="tutorial">
   <p id="instructText">Paste your JSON in the text area below and hit submit to see your gateways and services laid out automatically.</p>
   
   <p>Examples of JSON that works include:
      {"gateways": [{"id": "main","type": "main", "nodes": []}]} <br>
      
      The structure of the JSON file begins like this. {"gateways": []} <br>
      
      To add a gateway or service, we add to the array a JSON object with the following structure. <br></p>
      
      <pre >
      
      {"id": "NAME", "type": "TYPEOFSERVICE", "nodes": []} <br>
      </pre>
   
      <p>
      An example of a well-formed JSON file would be the following. <br>
      
      
   </p>
   </div>
  
    <textarea type="textbox" id='jsonText' >{"gateways": [{"id": "main","type": "main", "nodes": ["html"]}, {"id":"activemq", "type": "activemq", "nodes": ["main", "html"]}, {"id": "service", "type": "service", "nodes":[]}, {"id": "html", "type": "html", "nodes": ["service"]}]}</textarea>
   <input type="button" value="submit" id="submit" onclick="uponClick()"></input>
   <script>
      function uponClick() {
      var jsonValue = JSON.parse(document.getElementById("jsonText").value);
      drawgraph(s, jsonValue);
      }
  </script>

    <div id="container"> <h1>Config File JSON to Graph</h1></div> 

   
<script>

   var s = new sigma('container');
   s.settings('zoomingRatio', 1);

   function drawgraph(s, jsonObj) {
   
      s.graph.clear();
  
   var weights = {activemq: 1, main:2, html:3, postmsg:4, service:5};

   
   var heap = new Heap(function cmp(a, b) {
     if (a.weight < b.weight) {
       return -1;
     } 
     if (a.weight > b.weight) {
       return 1;
     }
     return 0;
   });
 
   var main = new RegExp('/main+/');

   var x = 0;
   var y = 0;
   var edge = 0;
   for (i = 0; i < jsonObj.gateways.length; i++) {
      var tempNode = jsonObj.gateways[i];
      tempNode.label = tempNode.id;
      tempNode.size = 3;
      tempNode.weight = weights[String(tempNode.type)];
      heap.push(tempNode);
      }
   
   for (i = 0; i < jsonObj.gateways.length; i++) {
      var tempNode = heap.pop();
      tempNode.x = Math.random(0, 0.2);
      tempNode.y = y + 0.2;
      x = x+0.2;
      y = y+0.2;
      s.graph.addNode(tempNode);

   }
   
   for (i = 0; i < jsonObj.gateways.length; i++) {
      var tempNode = jsonObj.gateways[i];
      if (tempNode.nodes != {}) {
         for (j = 0; j < tempNode.nodes.length; j++) {
         s.graph.addEdge({id:edge.toString(), target: tempNode.nodes[j], source: tempNode.id});
         edge++;
          }
      } 
   }
   alert("Done graphing.");
   s.refresh();
 
   }
</script>
 
</body>
</html>